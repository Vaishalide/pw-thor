<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HLS Player with Hardcoded Key</title>
    <!-- Using a reliable CDN for Tailwind CSS -->
    <script src="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.js"></script>
    <!-- HLS.js library for playback -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        video {
            width: 100%;
            max-width: 900px;
            background-color: #000;
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen font-sans p-4">

    <div class="w-full max-w-4xl text-center">
        <h1 class="text-3xl font-bold text-cyan-400 mb-2">HLS Stream Player</h1>
        <p class="text-gray-400 mb-6">Playing a specific signed stream with a hardcoded decryption key.</p>
    </div>

    <!-- Video Player -->
    <video id="videoPlayer" controls autoplay></video>
    
    <!-- Status Messages -->
    <div id="status_message" class="mt-4 text-center p-3 rounded-md text-sm"></div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const video = document.getElementById('videoPlayer');
            const statusMessage = document.getElementById('status_message');
            
            // --- Hardcoded Stream Information ---
            const M3U8_URL = 'https://sec-prod-mediacdn.pw.live/6814f036-66ba-481d-b1ae-7e9eef3d4ce8/master.m3u8?URLPrefix=aHR0cHM6Ly9zZWMtcHJvZC1tZWRpYWNkbi5wdy5saXZlLzY4MTRmMDM2LTY2YmEtNDgxZC1iMWFlLTdlOWVlZjNkNGNlOA&Expires=1754834051&KeyName=pw-prod-key&Signature=zxDe0aajxoHp4RyWtD634xWr9YG6UQmzeDnczPcfHsWWN_9v4sR_uUnYy_ZEpJ-Guz4FpjCLRTeZx33G__IhBQ';
            
            // The decryption key b'\xde\xb2\xa9...' converted to a JavaScript ArrayBuffer
            const DECRYPTION_KEY_BYTES = new Uint8Array([
                0xde, 0xb2, 0xa9, 0xec, 0x9c, 0xec, 0xe5, 0x74,
                0xf6, 0x4d, 0xdd, 0x8e, 0xa9, 0xa2, 0x3b, 0x09
            ]);
            const DECRYPTION_KEY_BUFFER = DECRYPTION_KEY_BYTES.buffer;
            // --- End of Hardcoded Information ---

            function updateStatus(message, colorClass) {
                statusMessage.textContent = message;
                statusMessage.className = `text-center p-3 rounded-md text-sm ${colorClass}`;
            }

            // A custom loader to inject the key and handle signed URLs
            class HardcodedKeyLoader extends Hls.DefaultConfig.loader {
                constructor(config) {
                    super(config);
                    // Extract signature parameters from the main URL
                    const urlObj = new URL(M3U8_URL);
                    this.signedParams = Object.fromEntries(urlObj.searchParams.entries());
                }

                load(context, config, callbacks) {
                    // Check if this is a request for the decryption key
                    if (context.type === 'key' || context.url.endsWith('enc.key')) {
                        console.log('[Loader] Intercepted key request. Providing hardcoded key.');
                        updateStatus('Decrypting with provided key...', 'text-yellow-400');
                        
                        // Immediately succeed with the hardcoded key data
                        callbacks.onSuccess(
                            { url: context.url, data: DECRYPTION_KEY_BUFFER },
                            { tload: performance.now(), loaded: 16 },
                            context
                        );
                        return;
                    }

                    // For all other requests, append the signature
                    try {
                        const urlObject = new URL(context.url);
                        Object.keys(this.signedParams).forEach(key => {
                            urlObject.searchParams.set(key, this.signedParams[key]);
                        });
                        context.url = urlObject.toString();
                    } catch (e) {
                        console.error("Error signing URL:", e);
                    }
                    
                    console.log(`[Loader] Forwarding signed request to: ${context.url}`);
                    super.load(context, config, callbacks);
                }
            }

            if (Hls.isSupported()) {
                updateStatus('HLS player supported. Loading video...', 'text-blue-400');
                const hls = new Hls({
                    loader: HardcodedKeyLoader // Use our custom loader
                });
                hls.loadSource(M3U8_URL);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    updateStatus('Video loaded successfully. Playing.', 'text-green-400');
                    video.play();
                });
                hls.on(Hls.Events.ERROR, (event, data) => {
                    if (data.fatal) {
                        console.error('Fatal HLS Error:', data);
                        updateStatus(`Error: ${data.details}`, 'text-red-500');
                    }
                });
            } else {
                updateStatus('HLS is not supported by this browser.', 'text-red-500');
            }
        });
    </script>
</body>
</html>
