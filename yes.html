<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>DRM Video Player</title>
  <script src="https://cdn.jsdelivr.net/npm/shaka-player@4.3.5/dist/shaka-player.compiled.js"></script>
  <style>
    body { background: #000; margin: 0; }
    video { width: 100%; height: 100vh; }
  </style>
</head>
<body>
  <video id="video" autoplay controls></video>

  <script>
    const VIDEO_API = "https://5f129b41-01f2-4d5a-8f1c-6dcb49be4165-00-8xnq81j897xt.pike.replit.dev/api/video?url=https://rarestudy.site/media/BAu7rBLTDTgrOZqyonVqkmEd1FmCvuwKVpnmEYQqpg40CVJP7eBzsmYkEUzFWT91LWyhGE2YrA5Iffw0FKU67Smau-YxJ48yT1sERLoMPfCyOPH_FeOCVQCviu7zvB6k5ETHHfFteuGPWSQ3DgRe3Y_yaJwttAXDQA90MYaNzuGgSvbroJlnrHF4aDZVkhhLJV961447KhkqOjoUtgA7BFKFk5eIRiSWejW7htD8eF0iYCt33T9veG9i55DREJrbZsVzFVYbsgmHJTUAllIFhqF_k9qASkJc0iwE8o3zmCTYn3irXKnP8Q8INHOn05CC4RO1q2bBV1W_t59cEz1t5DVCcjwDD-1VxTYQV0sT3pUyA_czK8_xG70QFKEbDHIe";

    async function initPlayer() {
      const response = await fetch(VIDEO_API);
      const data = await response.json();

      const video = document.getElementById("video");
      const player = new shaka.Player(video);

      window.player = player;

      if (data.drmType === "ClearKey" && data.key_strings) {
        const keys = {};
        const [kid, key] = data.key_strings.split('--key ')[1].split(':');
        keys[kid] = key;

        player.configure({
          drm: {
            clearKeys: keys
          }
        });
      }

      player.load(data.url).then(() => {
        console.log("Video loaded.");
      }).catch(err => {
        console.error("Error loading video", err);
      });
    }

    shaka.polyfill.installAll();
    if (shaka.Player.isBrowserSupported()) {
      initPlayer();
    } else {
      alert("Shaka Player not supported in this browser.");
    }
  </script>
</body>
</html>
